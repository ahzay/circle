<!--
  Create Circle Page Template
  
  Using Angular Material components with default styling only.
  
  Key concepts for Angular/Node.js beginners:
  - {{ }} is Angular's interpolation syntax for displaying data
  - @if is Angular's control flow for conditional rendering
  - (click) is event binding - connects DOM events to component methods
  - [disabled] is property binding - connects component properties to DOM attributes
  - FormGroup and FormControl handle form validation and state
-->

<mat-card>
  <mat-card-header>
    <mat-card-title>Create a Circle</mat-card-title>
    <mat-card-subtitle>Create a shared space for your trusted group to coordinate resources</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <!-- Show form if no circle has been created yet -->
    @if (!createdCircle()) {
      <!-- Reactive form for circle creation -->
      <form [formGroup]="createForm" (ngSubmit)="onSubmit()">
        
        <!-- Circle name input -->
        <mat-form-field appearance="outline" style="width: 100%; margin-bottom: 16px;">
          <mat-label>Circle Name</mat-label>
          <input 
            matInput 
            formControlName="circleName"
            placeholder="e.g., Maple Street Neighbors"
            maxlength="100"
          >
          <mat-hint>Choose a name that identifies your group</mat-hint>
          
          <!-- Show validation errors -->
          @if (getFieldError('circleName')) {
            <mat-error>{{ getFieldError('circleName') }}</mat-error>
          }
        </mat-form-field>

        <!-- Creator name input -->
        <mat-form-field appearance="outline" style="width: 100%; margin-bottom: 16px;">
          <mat-label>Your Name</mat-label>
          <input 
            matInput 
            formControlName="creatorName"
            placeholder="e.g., John Doe"
            maxlength="50"
          >
          <mat-hint>This is how others will see you in the circle</mat-hint>
          
          <!-- Show validation errors -->
          @if (getFieldError('creatorName')) {
            <mat-error>{{ getFieldError('creatorName') }}</mat-error>
          }
        </mat-form-field>

        <!-- Submit button -->
        <button 
          mat-raised-button 
          color="primary" 
          type="submit"
          [disabled]="isLoading() || !createForm.valid"
          style="margin-top: 16px;"
        >
          <!-- Show loading spinner when creating -->
          @if (isLoading()) {
            <mat-spinner diameter="20"></mat-spinner>
            Creating Circle...
          } @else {
            <ng-container>
              <mat-icon>group_add</mat-icon>
              Create Circle
            </ng-container>
          }
        </button>
      </form>
    }

    <!-- Show success state after circle is created -->
    @if (createdCircle()) {
      <div style="text-align: center; margin-bottom: 24px;">
        <mat-icon color="primary" style="font-size: 48px; width: 48px; height: 48px;">check_circle</mat-icon>
        <h2>Circle Created Successfully!</h2>
        <p>Your circle "{{ createdCircle()?.name }}" is ready to use</p>
      </div>

      <!-- Circle information -->
      <mat-card style="margin-bottom: 24px;">
        <mat-card-header>
          <mat-card-title>Circle Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p><strong>Name:</strong> {{ createdCircle()?.name }}</p>
          <p><strong>Created:</strong> {{ createdCircle()?.createdAtFormatted }}</p>
          <p><strong>Members:</strong> {{ createdCircle()?.userCount }} (just you for now)</p>
        </mat-card-content>
      </mat-card>

      <!-- Shareable link section -->
      <h3>Share Your Circle</h3>
      <p>Send this link to trusted friends and neighbors to let them join:</p>
      
      <div style="display: flex; gap: 12px; align-items: flex-end; margin-bottom: 24px;">
        <mat-form-field appearance="outline" style="flex: 1;">
          <mat-label>Shareable Link</mat-label>
          <input 
            matInput 
            [value]="createdCircle()?.shareableUrl"
            readonly
          >
        </mat-form-field>
        
        <button 
          mat-raised-button 
          color="accent" 
          (click)="copyShareableLink()"
        >
          <mat-icon>content_copy</mat-icon>
          Copy
        </button>
      </div>

      <!-- Action buttons -->
      <div style="display: flex; gap: 16px; justify-content: center;">
        <button 
          mat-raised-button 
          color="primary" 
          (click)="goToCircle()"
        >
          <mat-icon>arrow_forward</mat-icon>
          Go to Circle
        </button>

        <button 
          mat-stroked-button 
          (click)="createAnother()"
        >
          <mat-icon>add</mat-icon>
          Create Another Circle
        </button>
      </div>
    }
  </mat-card-content>
</mat-card>