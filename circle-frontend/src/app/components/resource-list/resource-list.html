<!-- 
  Resource List Template
  
  Displays all resources in a circle with Material Design cards.
  Shows loading state, error messages, and empty state handling.
  
  Key concepts for Angular/Node.js beginners:
  - @if/@else are Angular control flow statements (like if/else in JavaScript)
  - @for is Angular's loop directive (like for...of in JavaScript)
  - () binds to events (like addEventListener in JavaScript)
  - [] binds to properties (like setting element.property in JavaScript)
  - Signals are accessed with () like resources()
-->

<div class="resource-list-container">
  <!-- Loading state -->
  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading resources...</p>
    </div>
  }

  <!-- Error message -->
  @if (errorMessage()) {
    <mat-card class="error-card">
      <mat-card-content>
        <mat-icon color="warn">error</mat-icon>
        <span>{{ errorMessage() }}</span>
        <button mat-button (click)="loadResources()">Try Again</button>
      </mat-card-content>
    </mat-card>
  }

  <!-- Resources list -->
  @if (!isLoading() && !errorMessage()) {
    @if (resources().length === 0) {
      <!-- Empty state -->
      <mat-card class="empty-state">
        <mat-card-content>
          <mat-icon>inventory_2</mat-icon>
          <h3>No resources yet</h3>
          <p>Be the first to add a resource to this circle!</p>
        </mat-card-content>
      </mat-card>
    } @else {
      <!-- Resource cards -->
      <div class="resources-grid">
        @for (resource of resources(); track resource.id) {
          <mat-card class="resource-card">
            <mat-card-header>
              <mat-card-title>{{ resource.name }}</mat-card-title>
              <mat-card-subtitle>
                Owned by {{ resource.ownerName }}
                <span class="created-date">â€¢ {{ resource.createdAtFormatted }}</span>
              </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
              <p class="resource-description">{{ resource.description }}</p>
              
              <!-- Availability status -->
              <div class="resource-status">
                @if (resource.isAvailable) {
                  <mat-chip color="primary">Available</mat-chip>
                } @else {
                  <mat-chip color="warn">
                    Borrowed by {{ resource.currentBorrowerName }}
                  </mat-chip>
                }
              </div>
            </mat-card-content>

            <mat-card-actions>
              <!-- Borrow button for available resources (not owned by current user) -->
              @if (resource.isAvailable && !isOwner(resource)) {
                <button 
                  mat-raised-button 
                  color="primary" 
                  (click)="borrowResource(resource.id)">
                  <mat-icon>handshake</mat-icon>
                  Borrow
                </button>
              }
              
              <!-- Return button for resources borrowed by current user -->
              @if (!resource.isAvailable && isBorrower(resource)) {
                <button 
                  mat-raised-button 
                  color="accent" 
                  (click)="returnResource(resource.id)">
                  <mat-icon>keyboard_return</mat-icon>
                  Return
                </button>
              }
              
              <!-- Only show delete button if user owns the resource -->
              @if (isOwner(resource)) {
                <button 
                  mat-button 
                  color="warn" 
                  (click)="deleteResource(resource.id)"
                  [disabled]="!resource.isAvailable">
                  <mat-icon>delete</mat-icon>
                  Delete
                </button>
              }
            </mat-card-actions>
          </mat-card>
        }
      </div>
    }
  }
</div>
